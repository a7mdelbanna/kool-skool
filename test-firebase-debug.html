<!DOCTYPE html>
<html>
<head>
    <title>Firebase Debug - Students and SchoolIDs</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; }
        .section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Firebase Debug - Students and SchoolIDs</h1>
    
    <div class="section">
        <h2>1. Check LocalStorage Values</h2>
        <div id="localStorage"></div>
    </div>
    
    <div class="section">
        <h2>2. All Students in Firebase</h2>
        <div id="allStudents"></div>
    </div>
    
    <div class="section">
        <h2>3. Query Students by SchoolID</h2>
        <input type="text" id="schoolIdInput" placeholder="Enter SchoolID to query" style="width: 300px;">
        <button onclick="queryBySchoolId()">Query</button>
        <div id="queryResults"></div>
    </div>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD9Hk_uJgSOHRjQ8v5VrJwxRaLjQQ7c71k",
            authDomain: "kool-skool-7e858.firebaseapp.com",
            projectId: "kool-skool-7e858",
            storageBucket: "kool-skool-7e858.appspot.com",
            messagingSenderId: "732695735471",
            appId: "1:732695735471:web:36dd887c69b9bb49e31e44",
            measurementId: "G-4LVGHH0C8R"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        // Check localStorage
        function checkLocalStorage() {
            const output = document.getElementById('localStorage');
            
            // Check for schoolId
            const schoolId = localStorage.getItem('schoolId');
            const userData = localStorage.getItem('user');
            
            let html = '<h3>LocalStorage Values:</h3>';
            html += `<p><strong>Direct schoolId:</strong> ${schoolId || 'NOT FOUND'}</p>`;
            
            if (userData) {
                try {
                    const user = JSON.parse(userData);
                    html += `<p><strong>User object schoolId:</strong> ${user.schoolId || 'NOT FOUND'}</p>`;
                    html += `<p><strong>User email:</strong> ${user.email || 'N/A'}</p>`;
                    html += `<p><strong>User role:</strong> ${user.role || 'N/A'}</p>`;
                } catch (e) {
                    html += `<p class="error">Error parsing user data: ${e.message}</p>`;
                }
            } else {
                html += `<p class="error">No user data in localStorage</p>`;
            }
            
            output.innerHTML = html;
        }
        
        // Get all students
        async function getAllStudents() {
            const output = document.getElementById('allStudents');
            output.innerHTML = '<p>Loading all students...</p>';
            
            try {
                const snapshot = await db.collection('students').get();
                
                let html = `<h3>Total Students: ${snapshot.size}</h3>`;
                
                if (snapshot.empty) {
                    html += '<p class="error">No students found in Firebase!</p>';
                } else {
                    html += '<table border="1"><tr><th>ID</th><th>SchoolID</th><th>UserId</th><th>Course</th><th>Level</th></tr>';
                    
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        html += `<tr>
                            <td>${doc.id}</td>
                            <td class="info">${data.schoolId || 'MISSING'}</td>
                            <td>${data.userId || 'N/A'}</td>
                            <td>${data.courseName || 'N/A'}</td>
                            <td>${data.level || 'N/A'}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                    
                    // List unique schoolIds
                    const schoolIds = new Set();
                    snapshot.forEach(doc => {
                        if (doc.data().schoolId) {
                            schoolIds.add(doc.data().schoolId);
                        }
                    });
                    
                    html += '<h4>Unique SchoolIDs found:</h4><ul>';
                    schoolIds.forEach(id => {
                        html += `<li class="info">${id}</li>`;
                    });
                    html += '</ul>';
                }
                
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `<p class="error">Error fetching students: ${error.message}</p>
                                   <p class="info">This is expected - Firebase security rules require authentication.</p>
                                   <p class="info">To check if students exist:</p>
                                   <ol>
                                       <li>Open Firebase Console: <a href="https://console.firebase.google.com/project/kool-skool-7e858/firestore/data/~2Fstudents" target="_blank">View Students Collection</a></li>
                                       <li>Check if any documents exist in the students collection</li>
                                       <li>Note the schoolId field values</li>
                                   </ol>`;
            }
        }
        
        // Query by schoolId
        async function queryBySchoolId() {
            const schoolId = document.getElementById('schoolIdInput').value;
            const output = document.getElementById('queryResults');
            
            if (!schoolId) {
                output.innerHTML = '<p class="error">Please enter a schoolId</p>';
                return;
            }
            
            output.innerHTML = `<p>Querying for schoolId: ${schoolId}...</p>`;
            
            try {
                const snapshot = await db.collection('students')
                    .where('schoolId', '==', schoolId)
                    .get();
                
                let html = `<h4>Students with schoolId "${schoolId}": ${snapshot.size}</h4>`;
                
                if (snapshot.empty) {
                    html += `<p class="error">No students found with this schoolId!</p>`;
                } else {
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        html += `<div style="border: 1px solid #ddd; padding: 5px; margin: 5px 0;">
                            <p><strong>ID:</strong> ${doc.id}</p>
                            <p><strong>Course:</strong> ${data.courseName || 'N/A'}</p>
                            <p><strong>Level:</strong> ${data.level || 'N/A'}</p>
                        </div>`;
                    });
                }
                
                output.innerHTML = html;
            } catch (error) {
                output.innerHTML = `<p class="error">Error querying: ${error.message}</p>`;
            }
        }
        
        // Run checks on load
        window.onload = function() {
            checkLocalStorage();
            getAllStudents();
        };
    </script>
</body>
</html>