<!DOCTYPE html>
<html>
<head>
    <title>Test Firebase Students</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <h1>Firebase Student Fetch Test</h1>
    <div id="output"></div>
    
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyD9Hk_uJgSOHRjQ8v5VrJwxRaLjQQ7c71k",
            authDomain: "kool-skool-7e858.firebaseapp.com",
            projectId: "kool-skool-7e858",
            storageBucket: "kool-skool-7e858.appspot.com",
            messagingSenderId: "732695735471",
            appId: "1:732695735471:web:36dd887c69b9bb49e31e44",
            measurementId: "G-4LVGHH0C8R"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const output = document.getElementById('output');
        
        // Test fetching students
        async function testFetchStudents() {
            output.innerHTML = '<p>Testing student fetch...</p>';
            
            try {
                // Get schoolId from localStorage or use a test value
                const schoolId = localStorage.getItem('schoolId') || 'vf1L2hIQHZZhCgqEhKDKdnSnUrT2';
                
                output.innerHTML += `<p>Fetching students for schoolId: ${schoolId}</p>`;
                
                // Query students collection
                const studentsSnapshot = await db.collection('students')
                    .where('schoolId', '==', schoolId)
                    .get();
                
                output.innerHTML += `<p>Found ${studentsSnapshot.size} students</p>`;
                
                if (studentsSnapshot.empty) {
                    output.innerHTML += '<p style="color: orange;">No students found. Try creating a new student.</p>';
                } else {
                    output.innerHTML += '<h3>Students:</h3>';
                    
                    for (const doc of studentsSnapshot.docs) {
                        const student = doc.data();
                        const userId = student.userId;
                        
                        // Get user data
                        const userDoc = await db.collection('users').doc(userId).get();
                        const userData = userDoc.exists ? userDoc.data() : {};
                        
                        output.innerHTML += `
                            <div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0;">
                                <p><strong>ID:</strong> ${doc.id}</p>
                                <p><strong>Name:</strong> ${userData.firstName || ''} ${userData.lastName || ''}</p>
                                <p><strong>Email:</strong> ${userData.email || ''}</p>
                                <p><strong>Course:</strong> ${student.courseName || 'N/A'}</p>
                                <p><strong>Level:</strong> ${student.level || 'N/A'}</p>
                                <p><strong>Age Group:</strong> ${student.ageGroup || 'N/A'}</p>
                                <p><strong>Lesson Type:</strong> ${student.lessonType || 'N/A'}</p>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                output.innerHTML += `<p style="color: red;">Error: ${error.message}</p>`;
                console.error('Error fetching students:', error);
            }
        }
        
        // Run test when page loads
        testFetchStudents();
    </script>
</body>
</html>